<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla Interactiva - Contador Público</title>

<!-- Fuentes bonitas -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">

<style>
  :root{
    /* Paleta: tonos rosas/oscuro — sin blanco ni colores muy claros */
    --bg-main: #211019;
    --panel: #331a26;
    --card: #42232f;
    --card-approved: #2f3b35;
    --accent: #d45a88;
    --accent-deep: #ab3a63;
    --text-soft: #f1cfe0;   /* texto principal, suave (no blanco puro) */
    --muted: #b88ea0;       /* texto secundario */
    --locked-bg: #503142;
    --shadow: 0 10px 30px rgba(0,0,0,0.55);
    --radius: 12px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    padding:18px;
    font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg, var(--bg-main), #17070b);
    color:var(--text-soft);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  header{
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:flex-start;
    margin-bottom:16px;
  }
  .title{display:flex;flex-direction:column;gap:6px}
  h1{
    margin:0;
    font-family:"Playfair Display", serif;
    font-weight:600;
    font-size:20px;
    color:var(--accent);
  }
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .controls{display:flex;gap:8px;align-items:center}
  .btn{
    border:0;
    background:var(--accent);
    color:var(--text-soft);
    padding:8px 12px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
    box-shadow:var(--shadow);
  }
  .btn.ghost{
    background:transparent;
    color:var(--accent);
    border:1px solid rgba(212,90,136,0.12);
    box-shadow:none;
  }

  /* Grid de años */
  .grid{
    display:grid;
    grid-template-columns:repeat(5, minmax(0,1fr));
    gap:14px;
  }
  @media (max-width:980px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:520px){ .grid{grid-template-columns:1fr} }

  .year-card{
    background:linear-gradient(180deg,var(--panel), #2b1320);
    border-radius:var(--radius);
    padding:12px;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:160px;
  }
  .year-header{display:flex;align-items:center;justify-content:space-between}
  .year-title{font-weight:700;color:var(--accent);font-size:15px}
  .year-sub{font-size:12px;color:var(--muted)}

  .subjects{display:grid;gap:8px}

  .subject{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px;
    border-radius:10px;
    background:linear-gradient(180deg,var(--card), #2f1822);
    border:1px solid rgba(255,255,255,0.02);
    cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  }
  .subject:hover{transform:translateY(-3px)}
  .subject.locked{
    background:var(--locked-bg);
    color:var(--muted);
    cursor:not-allowed;
    opacity:0.96;
  }
  .subject.approved{
    background:linear-gradient(180deg,var(--card-approved), #263031);
    border:1px solid rgba(0,0,0,0.35);
    box-shadow:0 8px 18px rgba(0,0,0,0.55);
  }

  .sub-left{display:flex;gap:10px;align-items:center}
  .dot{
    width:44px;height:44px;border-radius:8px;
    display:flex;align-items:center;justify-content:center;
    font-weight:700;color:var(--text-soft);
    background:linear-gradient(180deg,var(--accent),var(--accent-deep));
    box-shadow:0 6px 12px rgba(0,0,0,0.5);
    font-size:14px;
  }
  .sub-info{display:flex;flex-direction:column}
  .sub-name{font-size:13px;font-weight:600;color:var(--text-soft)}
  .sub-code{font-size:11px;color:var(--muted)}

  .actions{display:flex;gap:8px;align-items:center}
  .icon{
    width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;
    background:transparent;border:1px dashed rgba(255,255,255,0.03)
  }

  .legend{display:flex;gap:8px;align-items:center}
  .chip{padding:6px 8px;border-radius:999px;font-size:12px}
  .chip.approved{background:#324f47;color:#bfeadd}
  .chip.locked{background:#4b2f3b;color:#ffc7e6}

  footer{margin-top:14px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .count{font-size:13px;color:var(--muted)}
  .small{font-size:12px;color:var(--muted)}

  /* tooltip simple */
  .tooltip{position:relative}
  .tooltip:hover::after{
    content:attr(data-tip);
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    bottom:calc(100% + 8px);
    background:rgba(20,10,15,0.92);
    color:var(--text-soft);
    padding:6px 8px;border-radius:6px;font-size:12px;white-space:nowrap;
    box-shadow:0 6px 14px rgba(0,0,0,0.6);
  }

  /* pequeño ajuste para accesibilidad en botones */
  button.subject{background:transparent;border:0;padding:0;text-align:left}
</style>
</head>
<body>
  <header>
    <div class="title">
      <h1>Malla Interactiva — Contador Público</h1>
      <p class="lead">Clic para marcar como aprobada. Las materias con correlativas quedan bloqueadas hasta aprobar requisitos.</p>
    </div>

    <div class="controls" role="toolbar" aria-label="Controles de la malla">
      <button id="resetBtn" class="btn ghost" title="Reiniciar todo el progreso">Reiniciar</button>
      <button id="exportBtn" class="btn" title="Exportar progreso JSON">Exportar</button>
      <button id="importBtn" class="btn" title="Importar progreso (JSON)">Importar</button>
      <input id="fileInput" type="file" accept="application/json" style="display:none" />
    </div>
  </header>

  <main>
    <div class="grid" id="gridYears" aria-live="polite"></div>

    <footer>
      <div class="legend">
        <div class="chip approved">Aprobada</div>
        <div class="chip locked">Bloqueada</div>
      </div>
      <div class="count" id="statusCount">0 / 37 materias aprobadas</div>
    </footer>
  </main>

  <small class="small" style="display:block;margin-top:12px">Progreso guardado localmente en tu navegador (localStorage).</small>

<script>
/* ---------------------------
   Config y datos (no tocar si no querés)
   --------------------------- */
const STORAGE_KEY = 'malla_contador_progreso_v_final';

/* Lista completa de materias y sus correlatividades (AND) */
const materias = [
  // 1er año
  { id:1,  name:'Introducción a las Ciencias Sociales', prereqs:[] },
  { id:2,  name:'Introducción a la Economía', prereqs:[] },
  { id:3,  name:'Introducción a la Administración', prereqs:[] },
  { id:4,  name:'Derecho constitucional y administrativo', prereqs:[] },
  { id:5,  name:'Introducción a la Contabilidad', prereqs:[] },
  { id:6,  name:'Introducción a la Matemática', prereqs:[] },
  { id:7,  name:'Derecho Privado', prereqs:[] },

  // 2do año
  { id:8,  name:'Sistemas y Procedimientos Administrativos', prereqs:[3] },
  { id:9,  name:'Microeconomía', prereqs:[1,2] },
  { id:10, name:'Contabilidad 1', prereqs:[5] },
  { id:11, name:'Matemática para Contadores', prereqs:[6] },
  { id:12, name:'Contabilidad 2', prereqs:[10] },
  { id:13, name:'Macroeconomía', prereqs:[1,2] },
  { id:14, name:'Métodos Estadísticos', prereqs:[11] },
  { id:15, name:'Derecho Comercial', prereqs:[7] },

  // 3er año
  { id:16, name:'Contabilidad 3', prereqs:[12] },
  { id:17, name:'Tecnología de la Información', prereqs:[8] },
  { id:18, name:'Finanzas Públicas', prereqs:[4,9] },
  { id:19, name:'Sociedades y Asociaciones', prereqs:[15] },
  { id:20, name:'Matemática Financiera', prereqs:[11] },
  { id:21, name:'Costos', prereqs:[8,14] },
  { id:22, name:'Relaciones Laborales y de la Seguridad Social', prereqs:[4] },
  { id:23, name:'Contabilidad 4', prereqs:[16] },

  // 4to año
  { id:24, name:'Impuestos 1', prereqs:[16,18] },
  { id:25, name:'Contabilidad 5', prereqs:[23] },
  { id:26, name:'Información para la Gestión', prereqs:[17,21] },
  { id:27, name:'Estructura y Política Económica Argentina', prereqs:[18,13] },
  { id:28, name:'Administración y Contabilidad Pública', prereqs:[8,12,18] },
  { id:29, name:'Práctica Profesional de Aplicación Jurídica', prereqs:[22,23,19] },
  { id:30, name:'Administración Financiera', prereqs:[8,14,20] },

  // 5to año
  { id:31, name:'Impuestos 2', prereqs:[24,22,19] },
  { id:32, name:'Auditoría', prereqs:[17,21,23,19,22] },
  { id:33, name:'Práctica Profesional de Aplicación Administrativo Contable', prereqs:[17,19,22,25] },
  { id:34, name:'Asignaturas Optativas', prereqs:[] },
  { id:35, name:'Concursos', prereqs:[17,19,22,23,29] },
  { id:36, name:'Asignaturas Electivas', prereqs:[] },
  { id:37, name:'Práctica Profesional Supervisada', prereqs:[] }
];

const anios = [
  { label:'1er año', ids:[1,2,3,4,5,6,7] },
  { label:'2do año', ids:[8,9,10,11,12,13,14,15] },
  { label:'3er año', ids:[16,17,18,19,20,21,22,23] },
  { label:'4to año', ids:[24,25,26,27,28,29,30] },
  { label:'5to año', ids:[31,32,33,34,35,36,37] }
];

/* ---------------------------
   Estado: Set de materias aprobadas
   --------------------------- */
let aprobadas = loadProgress();

/* ----- almacenamiento ----- */
function loadProgress(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return new Set();
    const arr = JSON.parse(raw);
    if(!Array.isArray(arr)) return new Set();
    return new Set(arr.map(n => Number(n)).filter(n => !isNaN(n)));
  } catch(e){
    console.warn('Error leyendo progreso:', e);
    return new Set();
  }
}
function saveProgress(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(aprobadas)));
    updateStatusCount();
  } catch(e){
    console.warn('Error guardando progreso:', e);
  }
}

/* Exportar progreso */
function exportProgress(){
  const data = { fecha: new Date().toISOString(), aprobadas: Array.from(aprobadas) };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'progreso_malla_contador.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* Importar progreso desde archivo JSON */
function importProgressFile(file){
  const reader = new FileReader();
  reader.onload = function(e){
    try{
      const obj = JSON.parse(e.target.result);
      if(Array.isArray(obj.aprobadas)){
        aprobadas = new Set(obj.aprobadas.map(x => Number(x)).filter(n => !isNaN(n)));
        saveProgress();
        render();
        alert('Progreso importado correctamente.');
      } else {
        alert('JSON inválido: falta propiedad "aprobadas".');
      }
    } catch(err){
      alert('No se pudo leer el archivo: ' + err);
    }
  };
  reader.readAsText(file);
}

/* ----- helpers ----- */
function getMateria(id){ return materias.find(m => m.id === id); }
function isUnlocked(m){
  if(!m.prereqs || m.prereqs.length === 0) return true;
  return m.prereqs.every(r => aprobadas.has(r));
}

/* Toggle aprobado/desaprobado */
function toggleAprobada(id){
  const m = getMateria(id);
  if(!isUnlocked(m) && !aprobadas.has(id)) {
    if(navigator.vibrate) navigator.vibrate(35);
    return;
  }
  if(aprobadas.has(id)) aprobadas.delete(id);
  else aprobadas.add(id);
  saveProgress();
  render();
}

/* Render principal */
function render(){
  const container = document.getElementById('gridYears');
  container.innerHTML = '';

  anios.forEach(a => {
    const sec = document.createElement('section');
    sec.className = 'year-card';
    sec.setAttribute('aria-label', a.label);

    const header = document.createElement('div');
    header.className = 'year-header';
    const title = document.createElement('div');
    title.innerHTML = `<div class="year-title">${a.label}</div><div class="year-sub">${a.ids.length} materias</div>`;
    header.appendChild(title);

    const right = document.createElement('div');
    right.className = 'year-sub';
    const aprox = a.ids.filter(id => aprobadas.has(id)).length;
    right.textContent = `${aprox} aprobadas`;
    header.appendChild(right);

    sec.appendChild(header);

    const subjects = document.createElement('div');
    subjects.className = 'subjects';

    a.ids.forEach(id => {
      const m = getMateria(id);
      const unlocked = isUnlocked(m);
      const approved = aprobadas.has(id);

      const item = document.createElement('button');
      item.className = 'subject';
      item.type = 'button';
      if(approved) item.classList.add('approved');
      if(!unlocked && !approved) item.classList.add('locked');
      item.setAttribute('data-id', id);
      item.setAttribute('aria-pressed', approved ? 'true' : '
