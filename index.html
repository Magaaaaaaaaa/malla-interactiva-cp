<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Malla Interactiva - Contador Público</title>

  <!-- Fuentes lindas -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #fff7fb;
      --card: #fff;
      --pink-1: #ffecf3;
      --pink-2: #ffb3d2;
      --accent: #ff7bb0;
      --muted: #8b6a76;
      --green: #57c39f;
      --locked: #f2d6df;
      --shadow: 0 6px 18px rgba(133,54,84,0.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg), #fff);
      color:#4b2b3a;
      padding:18px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
    }
    .title {
      display:flex;
      gap:12px;
      align-items:baseline;
    }
    h1{
      margin:0;
      font-family: "Playfair Display", serif;
      font-weight:700;
      font-size:20px;
      color:#3b1e2a;
    }
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;align-items:center}
    button, .btn {
      border:0;
      background:var(--accent);
      color:white;
      padding:8px 12px;
      border-radius:10px;
      font-weight:600;
      cursor:pointer;
      box-shadow:var(--shadow);
    }
    .btn.ghost{
      background:transparent;
      color:var(--accent);
      border:1px solid var(--pink-2);
      box-shadow:none;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(5, minmax(0,1fr));
      gap:14px;
    }
    @media (max-width:900px){
      .grid{grid-template-columns:repeat(2, 1fr)}
    }
    @media (max-width:520px){
      .grid{grid-template-columns:1fr}
    }
    .year-card{
      background: linear-gradient(180deg, var(--card), var(--pink-1));
      border-radius:12px;
      padding:12px;
      box-shadow:var(--shadow);
      min-height:160px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .year-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
    }
    .year-title{
      font-weight:700;
      color:#5b2333;
      font-size:15px;
    }
    .year-sub{font-size:12px;color:var(--muted)}
    .subjects{
      display:grid;
      grid-template-columns:repeat(1,1fr);
      gap:8px;
    }
    @media (min-width:600px){
      .subjects{grid-template-columns:repeat(1,1fr)}
    }
    .subject{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px;
      border-radius:10px;
      background:linear-gradient(180deg,#fff,#fffaf7);
      border:1px solid rgba(180,120,150,0.06);
      cursor:pointer;
      transition:transform .14s ease, box-shadow .14s ease;
    }
    .subject:hover{transform:translateY(-3px)}
    .subject.locked{background:var(--locked); color:#7a4658; cursor:not-allowed; opacity:0.95}
    .subject.approved{
      background:linear-gradient(180deg,#f7fffb,#e8fff5);
      border:1px solid rgba(80,170,145,0.14);
      box-shadow:0 6px 12px rgba(82,162,140,0.08);
    }
    .sub-left{display:flex;gap:10px;align-items:center}
    .dot{
      width:44px;height:44px;border-radius:8px;
      display:flex;align-items:center;justify-content:center;
      font-weight:700;
      color:white;
      background:linear-gradient(180deg,var(--accent),#ff5fa0);
      box-shadow:0 4px 10px rgba(255,123,176,0.12);
      flex-shrink:0;
    }
    .sub-info{display:flex;flex-direction:column}
    .sub-name{font-size:13px;font-weight:600}
    .sub-code{font-size:11px;color:var(--muted)}
    .actions{display:flex;gap:8px;align-items:center}
    .icon{
      width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;
      background:transparent;border:1px dashed rgba(150,110,130,0.06)
    }
    .icon.lock{background:transparent}
    small.help{display:block;color:var(--muted);font-size:12px;margin-top:6px}
    .legend{display:flex;gap:8px;align-items:center}
    .legend .chip{padding:6px 8px;border-radius:999px;font-size:12px}
    .chip.approved{background:linear-gradient(90deg,#eafff0,#d1ffea);color:#2b6b52;border:1px solid rgba(60,150,110,0.08)}
    .chip.locked{background:linear-gradient(90deg,#fff0f6,#ffe6ef);color:#8d4a62;border:1px solid rgba(200,120,150,0.06)}
    footer{margin-top:14px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .count{font-size:13px;color:var(--muted)}
    .small{font-size:12px;color:var(--muted)}
    /* tiny lock icon */
    .lock-icon{width:14px;height:14px;display:inline-block;vertical-align:middle}
    /* tooltip */
    .tooltip{
      position:relative;
    }
    .tooltip:hover::after{
      content:attr(data-tip);
      position:absolute;
      left:0; top:-36px;
      background:rgba(30,20,20,0.9);
      color:white;padding:6px 8px;border-radius:6px;font-size:12px;white-space:nowrap;
      transform:translateY(-4px);
    }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div>
        <h1>Malla Interactiva — Contador Público</h1>
        <p class="lead">Marca materias aprobadas. Las materias con correlativas quedan bloqueadas hasta aprobar los requisitos.</p>
      </div>
    </div>

    <div class="controls">
      <button id="resetBtn" class="btn ghost" title="Reiniciar progreso">Reiniciar progreso</button>
      <button id="exportBtn" class="btn" title="Exportar progreso">Exportar</button>
    </div>
  </header>

  <main>
    <div class="grid" id="gridYears" aria-live="polite"></div>

    <footer>
      <div class="legend">
        <div class="chip approved">Aprobada</div>
        <div class="chip locked">Bloqueada</div>
      </div>
      <div class="count" id="statusCount">0 / 37 materias aprobadas</div>
    </footer>
  </main>

  <small class="small" style="display:block;margin-top:12px">Guardado localmente en tu navegador (localStorage). Funciona offline y en móviles.</small>

<script>
/*
  Malla interactiva - un único archivo HTML
  - Datos: id, name, prereqs (array)
  - localStorage key: malla_contador_progreso
*/

const STORAGE_KEY = 'malla_contador_progreso_v1';

// Lista de materias con correlatividades según la estructura que diste.
// id = número tal cual.
const materias = [
  // 1er año
  { id:1,  name:'Introducción a las Ciencias Sociales', prereqs:[] },
  { id:2,  name:'Introducción a la Economía', prereqs:[] },
  { id:3,  name:'Introducción a la Administración', prereqs:[] },
  { id:4,  name:'Derecho constitucional y administrativo', prereqs:[] },
  { id:5,  name:'Introducción a la Contabilidad', prereqs:[] },
  { id:6,  name:'Introducción a la Matemática', prereqs:[] },
  { id:7,  name:'Derecho Privado', prereqs:[] },

  // 2do año
  { id:8,  name:'Sistemas y Procedimientos Administrativos', prereqs:[3] },
  { id:9,  name:'Microeconomía', prereqs:[1,2] },
  { id:10, name:'Contabilidad 1', prereqs:[5] },
  { id:11, name:'Matemática para Contadores', prereqs:[6] },
  { id:12, name:'Contabilidad 2', prereqs:[10] },
  { id:13, name:'Macroeconomía', prereqs:[1,2] },
  { id:14, name:'Métodos Estadísticos', prereqs:[11] },
  { id:15, name:'Derecho Comercial', prereqs:[7] },

  // 3er año
  { id:16, name:'Contabilidad 3', prereqs:[12] },
  { id:17, name:'Tecnología de la Información', prereqs:[8] },
  { id:18, name:'Finanzas Públicas', prereqs:[4,9] },
  { id:19, name:'Sociedades y Asociaciones', prereqs:[15] },
  { id:20, name:'Matemática Financiera', prereqs:[11] },
  { id:21, name:'Costos', prereqs:[8,14] },
  { id:22, name:'Relaciones Laborales y de la Seguridad Social', prereqs:[4] },
  { id:23, name:'Contabilidad 4', prereqs:[16] },

  // 4to año
  { id:24, name:'Impuestos 1', prereqs:[16,18] },
  { id:25, name:'Contabilidad 5', prereqs:[23] },
  { id:26, name:'Información para la Gestión', prereqs:[17,21] },
  { id:27, name:'Estructura y Política Económica Argentina', prereqs:[18,13] },
  { id:28, name:'Administración y Contabilidad Pública', prereqs:[8,12,18] },
  { id:29, name:'Práctica Profesional de Aplicación Jurídica', prereqs:[22,23,19] },
  { id:30, name:'Administración Financiera', prereqs:[8,14,20] },

  // 5to año
  { id:31, name:'Impuestos 2', prereqs:[24,22,19] },
  { id:32, name:'Auditoría', prereqs:[17,21,23,19,22] },
  { id:33, name:'Práctica Profesional de Aplicación Administrativo Contable', prereqs:[17,19,22,25] },
  { id:34, name:'Asignaturas Optativas', prereqs:[] },
  { id:35, name:'Concursos', prereqs:[17,19,22,23,29] },
  { id:36, name:'Asignaturas Electivas', prereqs:[] },
  { id:37, name:'Práctica Profesional Supervisada', prereqs:[] }
];

// Años y qué materias contienen
const anios = [
  { label:'1er año', ids:[1,2,3,4,5,6,7] },
  { label:'2do año', ids:[8,9,10,11,12,13,14,15] },
  { label:'3er año', ids:[16,17,18,19,20,21,22,23] },
  { label:'4to año', ids:[24,25,26,27,28,29,30] },
  { label:'5to año', ids:[31,32,33,34,35,36,37] }
];

let aprobadas = loadProgress(); // Set de ids aprobadas (Set para chequear rápido)
render();

function loadProgress(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return new Set();
    const arr = JSON.parse(raw);
    if(!Array.isArray(arr)) return new Set();
    return new Set(arr);
  } catch(e){
    console.warn('No se pudo leer progreso:', e);
    return new Set();
  }
}

function saveProgress(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify(Array.from(aprobadas)));
    updateStatusCount();
  } catch(e){
    console.warn('No se pudo guardar progreso:', e);
  }
}

function resetProgress(){
  if(confirm('¿Deseás reiniciar todo el progreso?')) {
    aprobadas = new Set();
    saveProgress();
    render(); // re-render para actualizar bloqueos
  }
}

function exportProgress(){
  const data = { fecha: new Date().toISOString(), aprobadas: Array.from(aprobadas) };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'progreso_malla_contador.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* Helper: obtener materia por id */
function getMateria(id){
  return materias.find(m => m.id === id);
}

/* Chequear si una materia está desbloqueada (todas sus prereqs aprobadas) */
function isUnlocked(m){
  // si no tiene prereqs -> desbloqueada
  if(!m.prereqs || m.prereqs.length === 0) return true;
  return m.prereqs.every(r => aprobadas.has(r));
}

/* Toggle aprobar/desaprobar */
function toggleAprobada(id){
  const materia = getMateria(id);
  if(!isUnlocked(materia)) {
    // bloqueada: no hacer nada
    return;
  }
  if(aprobadas.has(id)) aprobadas.delete(id);
  else aprobadas.add(id);

  // Guardar y re-renderizar porque desbloqueos pueden cambiar
  saveProgress();
  render();
}

/* Render de toda la malla */
function render(){
  const container = document.getElementById('gridYears');
  container.innerHTML = ''; // limpiar

  anios.forEach((a, idx) => {
    const div = document.createElement('section');
    div.className = 'year-card';
    div.setAttribute('aria-label', a.label);

    const header = document.createElement('div');
    header.className = 'year-header';
    const title = document.createElement('div');
    title.innerHTML = `<div class="year-title">${a.label}</div><div class="year-sub">${a.ids.length} materias</div>`;
    header.appendChild(title);

    const headerRight = document.createElement('div');
    headerRight.className = 'year-sub';
    const aprox = a.ids.filter(id => aprobadas.has(id)).length;
    headerRight.textContent = `${aprox} aprobadas`;
    header.appendChild(headerRight);

    div.appendChild(header);

    const subjects = document.createElement('div');
    subjects.className = 'subjects';

    a.ids.forEach(id => {
      const m = getMateria(id);
      const unlocked = isUnlocked(m);
      const approved = aprobadas.has(id);

      const item = document.createElement('button');
      item.className = 'subject';
      item.type = 'button';
      if(approved) item.classList.add('approved');
      if(!unlocked && !approved) item.classList.add('locked');
      item.setAttribute('data-id', id);
      item.setAttribute('aria-pressed', approved ? 'true' : 'false');
      item.setAttribute('aria-disabled', (!unlocked && !approved) ? 'true' : 'false');
      item.title = approved ? 'Click para desmarcar como aprobada' : (unlocked ? 'Click para marcar como aprobada' : 'Bloqueada - faltan correlativas');

      // Left: dot number + name
      const left = document.createElement('div');
      left.className = 'sub-left';
      const dot = document.createElement('div');
      dot.className = 'dot';
      dot.textContent = id;
      left.appendChild(dot);

      const info = document.createElement('div');
      info.className = 'sub-info';
      const name = document.createElement('div');
      name.className = 'sub-name';
      name.textContent = m.name;
      const code = document.createElement('div');
      code.className = 'sub-code';
      if(m.prereqs && m.prereqs.length) {
        code.textContent = 'Correlativas: ' + m.prereqs.join(', ');
      } else {
        code.textContent = 'Sin correlativas';
      }
      info.appendChild(name); info.appendChild(code);
      left.appendChild(info);

      // Right: action icon
      const right = document.createElement('div');
      right.className = 'actions';

      if(!unlocked && !approved){
        const lock = document.createElement('div');
        lock.className = 'icon lock tooltip';
        const missing = m.prereqs.filter(p => !aprobadas.has(p));
        lock.setAttribute('data-tip', 'Faltan: ' + (missing.length ? missing.join(', ') : '—'));
        lock.innerHTML = '<svg class="lock-icon" viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>';
        right.appendChild(lock);
      } else {
        const check = document.createElement('div');
        check.className = 'icon tooltip';
        check.setAttribute('data-tip', approved ? 'Aprobada' : 'Disponible');
        check.innerHTML = approved ? 
          ('<svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>') :
          ('<svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/></svg>');
        right.appendChild(check);
      }

      item.appendChild(left);
      item.appendChild(right);

      // click handler
      item.addEventListener('click', (ev) => {
        ev.preventDefault();
        // si está bloqueada y no aprobada -> nada
        if(!unlocked && !approved) {
          // dar pequeño feedback visual: vibrar si soporta
          if(navigator.vibrate) navigator.vibrate(30);
          return;
        }
        toggleAprobada(id);
      });

      subjects.appendChild(item);
    });

    div.appendChild(subjects);
    container.appendChild(div);
  });

  updateStatusCount();
}

/* Actualiza contador en footer */
function updateStatusCount(){
  const total = materias.length;
  const aprox = aprobadas.size;
  const el = document.getElementById('statusCount');
  if(el) el.textContent = `${aprox} / ${total} materias aprobadas`;
}

// Botones
document.getElementById('resetBtn').addEventListener('click', resetProgress);
document.getElementById('exportBtn').addEventListener('click', exportProgress);

// Guardado automático antes de cerrar (por si acaso)
window.addEventListener('beforeunload', () => {
  saveProgress();
});

</script>
</body>
</html>
